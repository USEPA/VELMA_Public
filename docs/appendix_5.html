<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width">
    <meta name="charset" content="utf-8">
    <link rel="stylesheet" type="text/css" href="public/css/style.css">
    <script src="https://requirejs.org/docs/release/2.3.7/minified/require.js"> </script>
    <script src="public/js/search.js" type="module"> </script>
    <script src="public/js/suggestion.js" type="module"> </script>
    <title> </title>
  </head>
  <body class="bg-primary">
    <div class="header blue-base">
      <nav class="navbar blue-base navbar-expand"><a class="navbar-brand" href="./index.html">VELMA 2.2 HOME</a>
        <ul class="navbar-nav no-bullets">
          <li class="nav-item dropdown">VELMA 2.0 Manual
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="./intro.html"><span>I. Intro</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./changes.html"><span>II. Changes from 1.0</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./about.html"><span>III. About</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./input_files.html"><span>IV. Input Files </span></a></li>
              <li class="nav-item"><a class="nav-link" href="./new_sim_config.html"><span>V. Sim Config</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./parameter_config.html"><span>VI. Parameter Config</span></a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">Appendicies
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="./appendix_1.html"><span>Overview of VELMA's Leaf-Stem-Root (LSR) Plant Biomass Submodel</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./appendix_2.html"><span>Initializing a Spatial Data Pool Using an ASCII Grid</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./appendix_3.html"><span>Creating Initial ASCII Grid Chemistry Spatial Data Pools</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./appendix_4.html"><span>Overview of VELMA Simulator Output</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./appendix_5.html"><span>Generating daily temperature and precipitation grids for running VELMA</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./appendix_6.html"><span>Hydrological and Biochemical Model Descriptions</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./appendix_7.html"><span>Creating Flat-Processed DEM Data For The VELMA Simulator</span></a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">Supplemental Info (VELMA 2.1)
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="./supplement-a1.html"><span>Organic Contaminant Modeling Using VELMA</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-a2.html"><span>Configure VELMA for Simulating Contaminant Fate and Transport</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-a3.html"><span>VELMA Contaminant Modeling Demonstration</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-a4.html"><span>Adding Stormwater Drains for Urban &amp; Mixed-Use Watershed Applications</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b1.html"><span>Creating Flat-Processed DEM Data for the VELMA Simulator</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b2.html"><span>JPDEM Cell Highlighter</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b3.html"><span>JPDEM Flow Accumulation (Facc) Threshold Display</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b4.html"><span>JPDEM Flow Test Tool</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b5.html"><span>JPDEM Saving Data to Files</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b6.html"><span>JPDEM User-Specified Map Borders</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b7.html"><span>JPDEM User-Specified Border Mask</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b8.html"><span>JPDEM for Viewing Map Differences</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b9.html"><span>JPDEM Sub-Reach Delineations</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-b10.html"><span>Flow Path Modification with the JPDEM Channel Cutter</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-c1.html"><span>VELMA Reach Mapping</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-c2.html"><span>How to Run VELMA in Parallel Mode</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-c3.html"><span>Rationale for Parallel Velma and Reach Segmentation</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d1.html"><span>Acquisition &amp; Generation of VELMA Input Data</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d2.html"><span>Soil Data Mapping and Parameter Initialization</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d3.html"><span>Initialize a Spatial Data Pool Using an Ascii Grid</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d4.html"><span>Create Initial Soil and Plant Chemistry Spatial (ASCII Grid) Data Pools</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d5.html"><span>Create Land-zoning Maps for a VELMA Application</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d6.html"><span>Add Georeferenced Projection Information to VELMA Output ASCII Maps</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d7a.html"><span>Create Multiple-Location Weather Drivers</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d7b.html"><span>Development of Statistical Models Based on Monthly PRISM / Daymet Data</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d8.html"><span>Cell Data Writer Configuration</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d9.html"><span>Set Up VELMA biomass Outputs as Inputs to BlueSky</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-d10.html"><span>Default Tidewater Model Configuration</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-e1.html"><span>Mapping Surface Layer Permeabilities</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-e2.html"><span>VELMA Surface Chemistry Pools</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-e3.html"><span>Deposition of Surface Chemicals</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-e4.html"><span>Implementing Green Roof Applications</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-e5.html"><span>Irrigation Disturbance</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-e6.html"><span>Groundwater Storage Mechanism</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./supplement-e7.html"><span>Spatial Data Writer Key Words for Generating ASCII VELMA Outputs for Data Visualization</span></a></li>
            </ul>
          </li>
          <li class="nav-item dropdown"> <a class="nav-link" href="./dev_info.html"><span>Developer Info</span></a>
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="./GetVelma_ForEclipse.html"><span>Clone Github to Local Machine</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./CellSpecificBurnDisturbance_Configuration_Guide.html"><span>Cell Specific Burn Disturbance Config Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./Configuration_Checker_Guide.html"><span>Configuration Checker Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./DefaultSedimentModel_Configuration_Guide.html"><span>Default Sediment Model Config Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./Sediment_Output_Data_Summary.html"><span>Sediment Output Data Summary</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./ForestBurnLsrDisturbanceModel_Overview.html"><span>Forest Burn LSR Disturbance Model</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./JPDEM_ReachMapping_Demonstration.html"><span>JPDEM Reaching Mapping Demo</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./MinMaxAirT_WeatherDrivers.html"><span>Min Max Air Temp Weather Drivers</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./ModifySpatialDataByMap_Guide.html"><span>Modify Spatial Data by Map Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./ObsRunoff_and_NaNs.html"><span>OBS Runnoff and NaNs</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./OrganicContaminant_Overview.html"><span>Organic Contaminant Overview</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./OrganicContaminant_Remediation_Configuration_Guide.html"><span>Organic Contaminant Redemption Config Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./OrganicContaminant_Tracer_Configuration_Guide.html"><span>Organic Contaminant Tracer Config Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./ReachSpecificObservedRunnoff.html"><span>Reach Specific Observed Runnoff</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./SnowDepth_Initialization_Guide.html"><span>Snow Depth Initialization Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./TopoFiles_Output_Summary.html"><span>Topo Files Output Summary </span></a></li>
              <li class="nav-item"><a class="nav-link" href="./VelmaParallel_Error_Reports.html"><span>Velma Parallel Error Reports</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./VelmaParallel_With_Multiple_Maps.html"><span>Velma Parallel With Multiple Maps </span></a></li>
              <li class="nav-item"><a class="nav-link" href="./WaterDrainDisturbanceModel_Overview.html"><span>Water Drain Disturbance Model</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./VelmaSimulatorCmdLine_Overview.html"><span>Velma Sim Cmd Line Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./VelmaSimulatorAltCmdLine_Overview.html"><span>Velma Sim Alt Cmd Line Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./SurfaceEvaporation_Overview.html"><span>Surface Evaporation Overview</span></a></li>
              <li class="nav-item"> <a class="nav-link" href="./LccmTranslatorUtility_Overview.html"><span>LCCM-to-VELMA Translator Utility</span></a></li>
              <li class="nav-item"> <a class="nav-link" href="./VelmaParallel_Piecewise_Configs.html"><span>Velma Parallel Piecewise Configuration</span></a></li>
            </ul>
          </li>
          <li class="nav-item dropdown"> <a class="nav-link" href="./dev_utils.html"><span>Developer Utils</span></a>
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="./AscMapOct_Guide.html"><span>Ascii Map Oct Guide </span></a></li>
              <li class="nav-item"><a class="nav-link" href="./AscRangeMask_Guide.html"><span>Ascii Range Mask Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./MoeVelGenerator_Guide.html"><span>MOEA-to-VELMA Configuration Generator</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./NashSutcliffeCalculator_Guide.html"><span>Tool for Computing Nash-Sutcliffe Coefficients</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./NseQuarts_Guide.html"><span>NseQuarts Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./VelmaSimRunner_QuickRef.html"><span>VelmaSimRunner Quick Reference</span></a></li>
              <li class="nav-item"><a class="nav-link" href="./VelmaSimRunner.html"><span>VelmaSimRunner Full Guide</span></a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
    <div class="modal" id="suggestionModal">
      <div class="modal-content"> <span class="close">&times;</span>
        <h2>Submit a Suggestion </h2>
        <form id="suggestionForm"> 
          <textarea class="suggestion_textbox" id="suggestionText" name="suggestionText" require="True" placeholder="Enter your suggestion here ..."> </textarea>
          <button class="submit_btn" type="submit">Submit</button>
        </form>
      </div>
    </div>
    <div class="main_body container" id="main_body">
      <div class="plus-sign">
        <p>+</p>
      </div>
      <h1>Appendix 5: Generating daily temperature and precipitation grids for running VELMA</h1>
      <h3>Introduction</h3>
      <p>The VELMA model runs at a daily time step on a spatial grid covering the study area of interest. The grid isscalable but is often desired to be at a fairly fine scale of resolution, e.g., 30-m cells. The model requiresdaily values of precipitation and mean temperature for each cell. Historic daily temperature and precipitationrecords can be obtained from weather stations in the National Weather Service or other networks. A simplisticapproach would be to assign temperature and precipitation values to each cell equal to those at the nearestweather station (Thiessen polygons). However, this would lead to a very “blocky” spatial data set with sharpdiscontinuities along lines equidistant from two weather stations.</p>
      <p>Smoother surfaces could be obtained by using algorithms such as inverse distance weighting to calculate valuesfor each cell depending on their distance from multiple weather stations. Both of these approaches ignorespatial variation in weather variables that are related to physiographic characteristics other than distancefrom a data source. Elevation is often a strong driver of both temperature gradients due to adiabatic coolingand precipitation gradients due to orographic effects produced as the rising air cools, lowering itsmoisture-holding capacity and causing precipitation of the excess.</p>
      <p>The PRISM model was developed to spatially interpolate climate data from observational networks in a way thataccounts for elevation and other physiographic variables of importance.</p>
      <p>Originally developed for precipitation (Daly et al. 1994), it has since been expanded to include temperature as well (Dalyet al. 2008). The model has become the most widely used source of spatial    climate data sets in the U.S. and has been extensively used worldwide (Daly and Bryant 2013).</p>
      <p>Daily time series of PRISM interpolated temperature and precipitation data are    supposed to be available for grids in the conterminous U.S. at a 4-km resolution (PRISM Climate Group 2013; data set AN81d), but as of 3/6/14 this FTP link    through the PRISM Climate Group web site (http://prism.oregonstate.edu/) was notfunctional. Even if available, a 4-km grid scale is very coarse compared to the finer scale resolution (e.g.,30-m) often desired for VELMA runs. Daily PRISM time series at higher resolution more suitable for supportingVELMA runs would need to be purchased, which would add significant cost to the application of VELMA to a studyarea. Depending on the number of cells in the study area, reading in daily grids of weather data would alsosignificantly slow down the processing time for VELMA runs as well as greatly increasing the memoryrequirements.</p>
      <p>This manual describes an alternative approach for providing VELMA with daily temperature and precipitation datafor each cell in a study grid. The desire is to capture the essence of PRISM's consideration of physiographicfactors, but without (a) the expense of purchasing custom PRISM high- resolution daily time series products, or(b) the processing time and memory requirements that use of these products would entail. The method involvesdeveloping statistical regression relationships between weather variables from PRISM monthly 30-year normal mapsand physiographic factors (elevation, etc.). Those relationships are then applied on a cell-by-cell basis,adjusting for the departure of daily weather values from monthly normals at a reference weather station in thestudy area. The steps involved in developing and applying these regressions are described below, using a VELMAapplication</p>
      <p>at the H.J. Andrews Experimental Forest in Oregon (hereafter referred to a HJA) as a specific example. Commentsare also given about how this may vary for other application study sites.</p>
      <h3>Procedure</h3>
      <h4>1. Choose candidate variables and assemble data</h4>
      <p>PRISM assumes that elevation is the most important factor in the distribution oftemperature and precipitation, but it also includes effects of a variety of other physiographic variables;these include topographic facet, proximity to coastlines, cold air drainage, and measures of topographiccomplexity (Daly and Bryant 2013). The first step in the regression approach is to choose proxyvariables, for which data are available on a cell-by-cell basis, that are relevant to these physiographicrelationships in PRISM. For the HJA we chose <u>elevation</u>, <u>flow accumulation</u>, and <u>heat loadindex</u>. Flow accumulation (also known as contributing area) is the areaof cells that are upslope of the target cell, into which water would flow. This is commonly used to modelhydrologic routing, but is also relevant to cold air drainage modeled in PRISM. Heat load index is avariable that quantifies the heat load from annual incident solar radiation as a function of slope andaspect (McCune and Keon 2002), which relates to the topographic facets in PRISM. In other study areas,other appropriate variables might include distance from coastline if there is a significant coastal to inlandgradient, or latitude if there is a sizable north to south gradient, for example.</p>
      <p>Once these physiographic variables have been selected, adata set must be assembled that includes values for each of the cells in the study area. In the HJA study, a30-m grid was used. A 30-m Digital Elevation Model (DEM) provided the data necessary for elevation andcalculation of flow accumulation and heat index in a Geographic Information System (GIS) for each 30-m gridcell. In addition to physiographic data, PRISM monthly “normals” for temperature and precipitation must beassembled for each cell. On the PRISM web site (http://prism.oregonstate.edu) data sets are freely available for the conterminous United States thatinclude 30-year monthly temperature and precipitation normals for 1981-2010 at resolutions of 800 m and 4 km(<a href="http://andrewsforest.oregonstate.edu/" target="_blank">PRISM Climate Group 2013</a>). As analternative, for the HJA study we used 50-m resolution PRISM data sets from the HJA web site(http://andrewsforest.oregonstate.edu/) that included monthly normals for totalprecipitation (mm) and daily mean temperature (C; average of daily minimum and daily maximum). The PRISMtemperature data were based on 30 years of weather station observation (1971-2000), but 50-m PRISM precipitationdata were only available at the time for 1981-1989. The monthly normals were rescaled to the 30-m grid, and thisdata set was merged with the 30-m physiographic data set. In summary, for each of 73,331 30-m cells the HJA dataset included:</p>
      <p>Jan - Dec monthly normal precipitation (mm/month)</p>
      <p>Jan - Dec monthly normal mean temperature (C; average of daily min and max) elevation (m)</p>
      <p>flow accumulation (unitless) heat load index (unitless)</p>
      <p>Example maps of these HJA data are shown in Fig. 1.</p>
      <h4>2. Exploratory data analysis</h4>
      <p>Once the data set has been read in, the distributions of values for the variables should be examined. This servestwo purposes. First, it allows checking to see if all values are in an appropriate range and that there have notbeen any gross data transcription errors. Second, it allows consideration of whether transformations of theoriginal variables might be another choice. In the case of the HJA data,</p>
      <p>for example, the flow accumulation variable was found to be very highly right skewed. A log10transformation was used to create an alternative variable for testing in the regression modelfitting.</p>
      <p>Correlation coefficients can be calculated between the weather variables (temperature and precipitation) and thephysiographic variables. As expected, and as assumed by PRISM, in the HJA data set this analysis revealed thatthe strongest correlation was with elevation. Plots of temperature and precipitation versus elevation should bemade for each month to see the form of this relationship. For HJA precipitation, this revealed fairly linearpatterns for some months (Fig. 2a), but concave-upwards patterns for other months (Fig. 2b) indicating apossible quadratic relationship with elevation.</p>
      <p>Consequently, an elevation2 variable was created for testing alternative regression models. For HJAtemperature, there was a linear increase with elevation up to a point, and then a linear decrease with elevation(Fig. 3). This indicated that a spline regression model be used, fitting a piecewise linear model with aninflection point.</p>
      <h4>3. Regression and model selection</h4>
      <p>Once the physiographic variables have been selected (step 1), additionalpolynomial terms have been created if indicated (step 2), and alternative transformations have been createdif indicated (step 2), then alternative regression models can be fit for each month and the most appropriatemodel form chosen. Akaike's information criterion (AIC; Akaike 1974) is a widely used statistic tochoose among competing regression models. It represents a compromise between goodness of fit (which increaseswith more parameters) and parsimony (which decreases with more parameters). In practice, ΔAIC values arecomputed as the model AIC value minus the minimum AIC value for all models tested.</p>
      <p>While it is possible that different models might have the lowest AIC value for different months, models with ΔAIC<u>&lt;</u> 2 are considered roughly equivalent. For consistency, it is desirable to choose a single model formthat applies for all months and has ΔAIC <u>&lt;</u> 2.</p>
      <p>For HJA precipitation, the dependent variable was the mean precipitation for each month, and theindependent variables were elevation (<i>elev</i>), elevation2 (<i>elevsq</i>), heat load index(<i>hli</i>), and log10 of flow accumulation (<i>logfacc</i>). Alternative regression models werefit that included <i>elev </i>and various subsets of the other variables. The full model with all thevariables was selected as the best model; it had ΔAIC = 0 for 8 of the 12 months and <u>&lt;</u>2 for theother 4 months (Fig. 4). The regression parameters are shown in Table 1. The regression residuals fell inside anenvelope of <u>+</u>20% (or better) of the monthly estimates over all months (Fig. 5). Sample SAS codefor generating and comparing the regression models is given in Appendix 5.1, below.</p>
      <p>For HJA temperature, the dependent variable was the mean temperature for each month, and the independentvariables were elevation (<i>elev</i>), heat load index (<i>hli</i>), and either flow accumulation (<i>facc</i>)or log10 of flow accumulation (<i>logfacc</i>). Alternative regression models were fit thatincluded <i>elev </i>and various subsets of the other variables. To do the spline fit, anon-linear regression procedure was used (PROC NLIN in SAS) that seeks an iterative solution to the regressionparameters for each of the two linear pieces, as well as the inflection point where they meet. The full modelwith <i>elev, hli, </i>and <i>facc </i>was selected as the best model; it had ΔAIC = 0 for 9 of the 12 months,<u>&lt;</u>2 for 2 months, and 2.6 for the remaining month (Fig. 6). Models incorporating <i>logfacc </i>ratherthan <i>facc </i>failed to converge for several of the months, so <i>facc </i>was used instead. The regressionparameters are shown in Table 2. The regression residuals roughly fell inside an envelope of <u>+</u>1 °C overall months (Fig. 7). Sample SAS code for generating and comparing the regression models is given in Appendix5.2, below.</p>
      <h4>4. Implementation to get daily temperature and precipitation</h4>
      <p>The regression models give estimates of the long-term normal monthly mean temperature and precipitation totals ateach cell, based on its elevation, heat load index, and flow accumulation values. (The monthly precipitationtotals must be divided by the number of days in the month to translate this to a daily basis.) However, manyVELMA applications seek to do simulations based on historic daily</p>
      <p>weather time series, or even on future scenarios of daily weather time series (adding projected temperature andprecipitation changes to historic weather time series, for example).</p>
      <p>One mechanism to translate the regression temperature and precipitation monthly estimates into daily time seriesfor each cell is to adjust the values using daily deviations from the monthly normals for a reference weatherstation in the study area. Essentially, this assumes that the daily deviations from climate normals are the sameacross the entire study area. For the HJA study, the PRIMET weather station was used as the reference (Fig. 8).(For future development, methods to use several reference weather stations might be explored, e.g., usinginverse distance weighting to determine the deviations to apply to each cell in the study area.) Using the HJAexample, the steps for this procedure were as follows:</p>
      <ul>
        <li>Compute expected daily PRIMET temperature (T) and precipitation (P) using the regression equations forthat month, and the <i>elev</i>, <i>hli</i>, and <i>facc </i>values for the PRIMET location. (Divide the monthlyP total estimates by the number of days in the month to get the daily estimate; this is not necessary fortemperature.)</li>
        <li>Using the observed daily PRIMET T and P values, compute T and P deviations (observed - expected).</li>
        <li>Compute expected T and P values for all other cells using their <i>elev</i>, <i>hli</i>, and <i>facc</i>values.</li>
        <li>Add the PRIMET T and P deviations to the expected values for all cells.</li>
        <li>Using P as an example:
          <ul> 
            <li>Subscript 0 denotes PRIMET, x denotes other location, m denotes month, ndaysm denotes number of days inmonth m, exp denotes expected value from regression</li>
            <li>P0 = observed P at PRIMET for a day in month m</li>
            <li>P0,exp = (am + bm*elev0 + cm*elevsq0+ dm*hli0 + em*logfacc0) / ndaysm Δ = P0 - P0,exp</li>
            <li>Px' = Px,exp + Δ</li>
            <li>\= (am + bm*<i>elev</i>x + cm*<i>elevsq</i>x +dm*<i>hli</i>x + em*<i>logfacc</i>x) / ndaysm + Δ</li>
          </ul>
        </li>
      </ul>
      <p>A test was done to make sure the adjustment was working correctly in the VELMA code by focusing on the 30-m cellin which PRIMET was located. For each day in 2007, the expected daily precipitation and temperature werecalculated from the regression equations and then adjusted following the procedure above. As expected, theadjusted simulated results for PRIMET were identical to the observed precipitation and temperature data,indicating that the code correctly implemented these procedures (Fig. 9).</p><img width="582" height="235" alt="image" src="public/Image_188.png"><img width="230" height="164" alt="L:Publicdphill02rom JonathanHJA Climate WorkHJA_ClimateModeling_FACC.png" title="L:Publicdphill02rom JonathanHJA Climate WorkHJA_ClimateModeling_FACC.png" src="public/Image_189.jpg"><img width="230" height="164" alt="L:Publicdphill02rom JonathanHJA Climate WorkHJA_ClimateModeling_Elevation.png" title="L:Publicdphill02rom JonathanHJA Climate WorkHJA_ClimateModeling_Elevation.png" src="public/Image_190.jpg"><img width="579" height="2" alt="image" src="public/Image_191.png">
      <p>Fig. 1 - Example maps of H.J. Andrew Experimental Forest PRISM climate and physiographic variables.</p><img width="474" height="337" alt="image" src="public/Image_192.png"><img width="462" height="324" alt="M:SASfilesHJAMay ppt vs elev.jpg" title="M:SASfilesHJAMay ppt vs elev.jpg" src="public/Image_193.jpg">
      <p>Fig. 2 - Plots of monthly mean precipitation (mm) versus elevation for H.J. Andrews Experimental Forest. (a)November data, showing more or less linear increase. (b) May data, showing a quadratic increase.</p><img width="626" height="445" alt="image" src="public/Image_194.png">
      <p>Fig. 3 - Plots of monthly mean temperature (C) for November versus elevation for H.J. Andrews ExperimentalForest. Note the piecewise linear relationship, with an inflection point at around 700 m elevation.</p><img width="628" height="463" alt="image" src="public/Image_195.png">
      <p>Fig. 4 - Plot of ΔAIC over all months for alternative precipitation regression models at H.J. AndrewsExperimental Forest. E = elevation, E2 = elevation2, H = heat load index, F = log10 of flowaccumulation.</p><img width="611" height="433" alt="M:SASfilesHJANovember ppt residuals.jpg" title="M:SASfilesHJANovember ppt residuals.jpg" src="public/Image_196.jpg">
      <p>Fig. 5 - Graph of November precipitation regression residuals versus predicted precipitation at H.J. AndrewsExperimental Forest. Red bounding lines represent <u>+</u>20% of the monthly precipitation estimate.</p><img width="628" height="466" alt="image" src="public/Image_197.png">
      <p>Fig. 6 - Plot of ΔAIC over all months for alternative temperature regression models at H.J. Andrews ExperimentalForest. E = elevation, H = heat load index, F = flow accumulation.</p><img width="626" height="445" alt="image" src="public/Image_198.png">
      <p>Fig. 7 - Graph of November mean temperature regression residuals versus predicted precipitation at H.J. AndrewsExperimental Forest. Red bounding lines represent <u>+</u>1 °C.</p><img width="605" height="450" alt="image" src="public/Image_199.jpg">
      <p>Fig. 8 - Map of weather station locations at the H.J. Andrews Experimental Forest.</p><img width="628" height="358" alt="image" src="public/Image_200.png">
      <p>Fig. 9 - Comparison of observed H.J. Andrews Experimental Forest PRIMET weather station daily mean temperaturefor 2007 and VELMA simulated data for the same location. The VELMA simulated data used the temperatureregression equation to estimate monthly normal temperature for the cell containing PRIMET, and then madeadjustments based on the observed PRIMET daily mean temperature. This is a check to make sure that theimplementation of the temperature regression and adjustment is working correctly, as indicated by thecoincidence of the blue and red lines (red is on top).</p>
      <table>
        <tr>
          <td>Month</td>
          <td>a</td>
          <td>b</td>
          <td>c</td>
          <td>d</td>
          <td>e</td>
        </tr>
        <tr>
          <td>1</td>
          <td>259.751</td>
          <td>0.011833</td>
          <td>5.24E-05</td>
          <td>-3.94717</td>
          <td>-0.09685</td>
        </tr>
        <tr>
          <td>2</td>
          <td>241.5404</td>
          <td>0.006131</td>
          <td>6.1E-05</td>
          <td>-5.15183</td>
          <td>0.892817</td>
        </tr>
        <tr>
          <td>3</td>
          <td>210.8037</td>
          <td>0.037236</td>
          <td>4.62E-05</td>
          <td>-4.20577</td>
          <td>0.951439</td>
        </tr>
        <tr>
          <td>4</td>
          <td>96.40946</td>
          <td>0.080534</td>
          <td>7.44E-06</td>
          <td>-1.44569</td>
          <td>1.250961</td>
        </tr>
        <tr>
          <td>5</td>
          <td>88.34944</td>
          <td>0.014202</td>
          <td>3.06E-05</td>
          <td>-0.20094</td>
          <td>1.259266</td>
        </tr>
        <tr>
          <td>6</td>
          <td>53.51838</td>
          <td>0.048195</td>
          <td>9.53E-06</td>
          <td>0.873204</td>
          <td>1.297879</td>
        </tr>
        <tr>
          <td>7</td>
          <td>13.08702</td>
          <td>0.023576</td>
          <td>2.49E-06</td>
          <td>0.686924</td>
          <td>0.685529</td>
        </tr>
        <tr>
          <td>8</td>
          <td>21.89397</td>
          <td>7.78E-05</td>
          <td>6.23E-06</td>
          <td>-0.00893</td>
          <td>0.199088</td>
        </tr>
        <tr>
          <td>9</td>
          <td>70.03036</td>
          <td>0.007598</td>
          <td>2.39E-05</td>
          <td>-0.00868</td>
          <td>0.959202</td>
        </tr>
        <tr>
          <td>10</td>
          <td>124.4332</td>
          <td>-0.00302</td>
          <td>3.59E-05</td>
          <td>-1.16562</td>
          <td>0.890761</td>
        </tr>
        <tr>
          <td>11</td>
          <td>316.075</td>
          <td>0.072349</td>
          <td>4.32E-05</td>
          <td>-4.40543</td>
          <td>1.247633</td>
        </tr>
        <tr>
          <td>12</td>
          <td>290.7049</td>
          <td>0.034712</td>
          <td>4.62E-05</td>
          <td>-4.46288</td>
          <td>0.495517</td>
        </tr>
      </table>
      <p>Table 1. Monthly mean precipitation regression model coefficients based on PRISM data for 30-m cells in the H. J. Andrews Experimental Forest. The models are of the form:</p>
      <p><i>P</i> = a + b*elev + c*elevsq + d*hli + e*logfacc</p>
      <p><i>P </i>in mm/month, <i>elev </i>in m, <i>elevsq </i>in m2, <i>hli </i>is unitless, <i>logfacc </i>is
        <unitless></unitless>
      </p>
      <table>
        <tr>
          <td>Month</td>
          <td>b</td>
          <td>c</td>
          <td>d</td>
          <td>e</td>
          <td>g</td>
          <td>h</td>
          <td>i</td>
          <td>j</td>
          <td>x</td>
        </tr>
        <tr>
          <td>1</td>
          <td>0.007047</td>
          <td>0.018444</td>
          <td>2.75E-06</td>
          <td>-1.12696</td>
          <td>-0.00434</td>
          <td>0.012177</td>
          <td>-1.6E-05</td>
          <td>6.606466</td>
          <td>679.15</td>
        </tr>
        <tr>
          <td>2</td>
          <td>0.006148</td>
          <td>0.065628</td>
          <td>2.76E-06</td>
          <td>1.024448</td>
          <td>-0.00545</td>
          <td>0.037565</td>
          <td>-1.5E-05</td>
          <td>8.958362</td>
          <td>684.28</td>
        </tr>
        <tr>
          <td>3</td>
          <td>0.001492</td>
          <td>0.041412</td>
          <td>1.47E-06</td>
          <td>5.402304</td>
          <td>-0.00656</td>
          <td>0.039723</td>
          <td>-5.7E-06</td>
          <td>11.03547</td>
          <td>699.67</td>
        </tr>
        <tr>
          <td>4</td>
          <td>-0.00239</td>
          <td>0.053357</td>
          <td>2.53E-07</td>
          <td>10.24696</td>
          <td>-0.00697</td>
          <td>0.043574</td>
          <td>6.13E-06</td>
          <td>13.99039</td>
          <td>818.03</td>
        </tr>
        <tr>
          <td>5</td>
          <td>0.004219</td>
          <td>0.059169</td>
          <td>1.86E-06</td>
          <td>8.916032</td>
          <td>-0.00707</td>
          <td>0.056038</td>
          <td>-1.2E-05</td>
          <td>16.80074</td>
          <td>698.66</td>
        </tr>
        <tr>
          <td>6</td>
          <td>-0.00222</td>
          <td>0.046785</td>
          <td>-1.3E-06</td>
          <td>16.98087</td>
          <td>-0.00684</td>
          <td>0.078366</td>
          <td>1.33E-05</td>
          <td>20.81386</td>
          <td>827.75</td>
        </tr>
        <tr>
          <td>7</td>
          <td>-0.00123</td>
          <td>0.004955</td>
          <td>-2.5E-06</td>
          <td>19.38073</td>
          <td>-0.00633</td>
          <td>0.073345</td>
          <td>-1.9E-06</td>
          <td>23.54351</td>
          <td>814.57</td>
        </tr>
        <tr>
          <td>8</td>
          <td>-0.00023</td>
          <td>0.00407</td>
          <td>-2.6E-06</td>
          <td>18.81907</td>
          <td>-0.00585</td>
          <td>0.007047</td>
          <td>9.03E-06</td>
          <td>23.53079</td>
          <td>836.26</td>
        </tr>
        <tr>
          <td>9</td>
          <td>0.001476</td>
          <td>-0.0342</td>
          <td>-2.3E-06</td>
          <td>14.80655</td>
          <td>-0.00612</td>
          <td>0.047614</td>
          <td>7.6E-06</td>
          <td>20.83291</td>
          <td>791.89</td>
        </tr>
        <tr>
          <td>10</td>
          <td>-0.00023</td>
          <td>0.018716</td>
          <td>-1.2E-06</td>
          <td>11.70249</td>
          <td>-0.00641</td>
          <td>0.112236</td>
          <td>-8.6E-06</td>
          <td>16.77907</td>
          <td>819.27</td>
        </tr>
        <tr>
          <td>11</td>
          <td>0.002002</td>
          <td>0.014029</td>
          <td>-2.6E-07</td>
          <td>3.771477</td>
          <td>-0.00556</td>
          <td>0.027117</td>
          <td>-1.4E-05</td>
          <td>9.412401</td>
          <td>745.95</td>
        </tr>
        <tr>
          <td>12</td>
          <td>0.00697</td>
          <td>0.047469</td>
          <td>2.59E-06</td>
          <td>-1.28579</td>
          <td>-0.00399</td>
          <td>0.007256</td>
          <td>-1.7E-05</td>
          <td>6.096779</td>
          <td>674.34</td>
        </tr>
      </table>
      <p>Table 2. Monthly mean temperature regression model coefficients based on PRISM data for 30-m cells in the H. J. Andrews Experimental Forest. The models are of the form:</p>
      <p>For elev &lt; x: T = b*elev + c*hli + d*facc + e </p>
      <p>For elev <u>&gt;</u> x: T = g*elev + h*hli + i*facc + j</p>
      <p>T is in °C, elev in m, hli is unitless, facc is unitless</p>
      <h5>References</h5>
      <ol> 
        <li>Akaike H (1974) A new look at the statistical model identification. IEEE Transactions on Automatic Control 19:716-723</li>
        <li>Daly C, Bryant K (2013) The PRISM Climate and Weather System - An Introduction. In. PRISM Climate Group, Oregon State University, Corvallis, Oregon, <a href="http://prism.oregonstate.edu/documents/PRISM_history_jun2013.pdf"> http://prism.oregonstate.edu/documents/PRISM_history_jun2013.pdf </a></li>
        <li>Daly C, Halbleib M, Smith JI et al. (2008) Physiographically sensitive mapping of climatological temperature and precipitation across the conterminous United States. International Journal of Climatology 28:2031-2064</li>
        <li>Daly C, Neilson RP, Phillips DL (1994) A statistical-topographic model for mapping climatological precipitation over mountainous terrain. Journal of Applied Meteorology 33:140-158</li>
        <li>McCune B, Keon D (2002) Equations for potential annual direct incident radiation and heat load. Journal of Vegetation Science 13:603-606</li>
        <li>PRISM Climate Group (2013) Descriptions of PRISM Spatial Climate Datasets for the Conterminous United States. In. PRISM Climate Group, Oregon State University, Corvallis, Oregon, <a href="http://prism.oregonstate.edu/documents/PRISM_history_jun2013.pdf"> http://prism.oregonstate.edu/documents/PRISM_history_jun2013.pdf</a></li>
      </ol>
      <h2>Appendix 5.1 - Sample SAS code for generating and comparing monthly total precipitation regression models at H.J. Andrews Experimental Forest.</h2><code>proc reg data=hja.hja outest=parmout; by month; model ppt = elev elevsq hli logfacc / selection=cp aic; output out=pptout p=phat r=presid;</code>
      <h6>Notes:</h6>
      <ol> 
        <li>The input data are read in from the file 'hja' in the SAS library (folder) 'hja'.</li>
        <li>Separate models are fit for each month.</li>
        <li>With the 'selection' option, models are fit using all the various sets of independent variables listed.</li>
        <li>By using the 'aic' option, Akaike Information Criterion (AIC) values are given in the output for each model. This allows calculation of ΔAIC compared to the model with the lowest AIC value (Fig. 4).</li>
        <li>The parameter estimates for each model are written to the file 'parmout' (Table 1).</li>
        <li>Predicted estimates ('phat') and residuals ('presid') are written to the file 'pptout' for plotting residuals vs. predicted values (Fig. 5).</li>
      </ol>
      <h2>Appendix 5.2 - Sample SAS code for generating and comparing monthly temperature regression models at H.J. Andrews Experimental Forest.</h2>
      <pre> <code>TEMP MODEL WITH ELEV, HLI, FACC. BEST MODEL - MIN AIC FOR MOST MONTHS, MINIMAL DELTA AIC FOR OTHER MONTHS;</code><code>Segmented model, linear with elev above and below a join point x;</code><code>proc nlin data=hja.hja outest=parmout; by month;</code><code>parms b=0.01 c=0 d=0 e=0 g=-0.005 h=0 i=0</code><code>j=10; file print;</code><code>x = ((h-c)*hli + (i-d)*facc + (j-e))/(b-g); if elev &lt; x then do;</code><code>model temp = b*elev + c*hli + d*facc + e; der.b = elev;</code><code>der.c = hli; der.d = facc; der.e = 1;</code><code>der.g = 0;</code><code>der.h = 0;</code><code>der.i = 0;</code><code>der.j = 0;</code><code>end; else do;</code><code>model temp = g*elev + h*hli + i*facc + j; der.b = 0;</code><code>der.c = 0;</code><code>der.d = 0;</code><code>der.e = 0; der.g = elev; der.h = hli; der.i = facc; der.j = 1;</code><code>end;</code><code>if _obs_=1 then do; * PRINT X ESTIMATE TO TRACK CONVERGENCE;</code><code>    put x =; </code><code>end;</code><code>output out=tempout predicted=that residual=tresid;</code></pre>
      <h5>Notes:</h5>
      <ol> 
        <li>The input data are read in from the file 'hja' in the SAS library (folder) 'hja'.</li>
        <li>Separate models are fit for each month.</li>
        <li>This is a spline model, fitting linear models above and below an inflection point at elevation <i>x</i>,which is also estimated. This requires use of an iterative non-linear procedure (PROC NLIN). Unlike PROC REG inAppendix 5.1, this does not have the capability to fit multiple alternative models at once and report the AICvalues for each. Instead, each alternative model must be specified. The above code specifies the full model with<i>elev</i>, <i>hli</i>, and <i>facc</i>. AIC values are not automatically printed and must be calculated fromthe sum of squares error (SSE), number of parameters (p; 4 in this case), and number of sample points (n; 73,331in this case), according to the formula: AIC = n * ln(SSE / n) + 2*p. ΔAIC values are then calculated bysubtracting the AIC for the model with the lowest AIC value (Fig. 6).</li>
        <li>The 'parms' statement specifies starting values for the parameters to begin the iterative search for bestfit.</li>
        <li><i>x </i>represents the elevation at which the two piecewise linear models meet. To make the overallmodel continuous requires that the estimated temperature must be the same for both piecewise linear models atthat point. The expression for <i>x </i>is derived by setting the two models equal to each other and solving for<i>elev </i>at which they are equal:
          <div class="math">
            <p>b*<i>elev </i>+ c*<i>hli </i>+ d*<i>facc </i>+ e = g*<i>elev </i>+ h*<i>hli </i>+ i*<i>facc </i>+ j </p>
            <p>b*<i>elev</i>- g*<i>elev </i>= h*<i>hli </i>- c*<i>hli </i>+ i*<i>facc </i>- d*<i>facc </i>+ j - e</p>
            <p>x = elev = ((h - c)*hli + (I - d)*facc + (j - e))/(b - g)</p>
          </div>
        </li>
        <li>The 'der' statements specify the first derivatives of each of the linear models with respect to each of theparameters.</li>
        <li>The parameter estimates for each model are written to the file 'parmout' (Table 2).</li>
        <li>Predicted estimates ('that') and residuals ('tresid') are written to the file 'tempout' for plotting residualsvs. predicted values (Fig. 7).</li>
      </ol>
    </div>
  </body>
  <footer id="footer">
    <p>VELMA 2.2 DOCUMENTATION</p>
  </footer>
</html>