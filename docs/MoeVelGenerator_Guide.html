<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width">
    <meta name="charset" content="utf-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <script src="https://requirejs.org/docs/release/2.3.7/minified/require.js"> </script>
    <script src="js/search.js" type="module"> </script>
    <script src="js/suggestion.js" type="module"> </script>
    <title> </title>
  </head>
  <body class="bg-primary">
    <div class="header blue-base">
      <nav class="navbar blue-base navbar-expand"><a class="navbar-brand" href="/index.html">VELMA 2.2 HOME</a>
        <ul class="navbar-nav no-bullets">
          <li class="nav-item dropdown">VELMA 2.0 Manual
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="/intro.html"><span>I. Intro</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/changes.html"><span>II. Changes from 1.0</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/about.html"><span>III. About</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/input_files.html"><span>IV. Input Files </span></a></li>
              <li class="nav-item"><a class="nav-link" href="/new_sim_config.html"><span>V. Sim Config</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/parameter_config.html"><span>VI. Parameter Config</span></a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">Appendicies
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="/appendix_1.html"><span>Overview of VELMA's Leaf-Stem-Root (LSR) Plant Biomass Submodel</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/appendix_2.html"><span>Initializing a Spatial Data Pool Using an ASCII Grid</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/appendix_3.html"><span>Creating Initial ASCII Grid Chemistry Spatial Data Pools</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/appendix_4.html"><span>Overview of VELMA Simulator Output</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/appendix_5.html"><span>Generating daily temperature and precipitation grids for running VELMA</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/appendix_6.html"><span>Hydrological and Biochemical Model Descriptions</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/appendix_7.html"><span>Creating Flat-Processed DEM Data For The VELMA Simulator</span></a></li>
            </ul>
          </li>
          <li class="nav-item dropdown">Supplemental Info (VELMA 2.1)
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="/supplement-a1.html"><span>Organic Contaminant Modeling Using VELMA</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-a2.html"><span>Configure VELMA for Simulating Contaminant Fate and Transport</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-a3.html"><span>VELMA Contaminant Modeling Demonstration</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-a4.html"><span>Adding Stormwater Drains for Urban &amp; Mixed-Use Watershed Applications</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b1.html"><span>Creating Flat-Processed DEM Data for the VELMA Simulator</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b2.html"><span>JPDEM Cell Highlighter</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b3.html"><span>JPDEM Flow Accumulation (Facc) Threshold Display</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b4.html"><span>JPDEM Flow Test Tool</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b5.html"><span>JPDEM Saving Data to Files</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b6.html"><span>JPDEM User-Specified Map Borders</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b7.html"><span>JPDEM User-Specified Border Mask</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b8.html"><span>JPDEM for Viewing Map Differences</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b9.html"><span>JPDEM Sub-Reach Delineations</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-b10.html"><span>Flow Path Modification with the JPDEM Channel Cutter</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-c1.html"><span>VELMA Reach Mapping</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-c2.html"><span>How to Run VELMA in Parallel Mode</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-c3.html"><span>Rationale for Parallel Velma and Reach Segmentation</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d1.html"><span>Acquisition &amp; Generation of VELMA Input Data</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d2.html"><span>Soil Data Mapping and Parameter Initialization</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d3.html"><span>Initialize a Spatial Data Pool Using an Ascii Grid</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d4.html"><span>Create Initial Soil and Plant Chemistry Spatial (ASCII Grid) Data Pools</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d5.html"><span>Create Land-zoning Maps for a VELMA Application</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d6.html"><span>Add Georeferenced Projection Information to VELMA Output ASCII Maps</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d7a.html"><span>Create Multiple-Location Weather Drivers</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d7b.html"><span>Development of Statistical Models Based on Monthly PRISM / Daymet Data</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d8.html"><span>Cell Data Writer Configuration</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d9.html"><span>Set Up VELMA biomass Outputs as Inputs to BlueSky</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-d10.html"><span>Default Tidewater Model Configuration</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-e1.html"><span>Mapping Surface Layer Permeabilities</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-e2.html"><span>VELMA Surface Chemistry Pools</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-e3.html"><span>Deposition of Surface Chemicals</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-e4.html"><span>Implementing Green Roof Applications</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-e5.html"><span>Irrigation Disturbance</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-e6.html"><span>Groundwater Storage Mechanism</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/supplement-e7.html"><span>Spatial Data Writer Key Words for Generating ASCII VELMA Outputs for Data Visualization</span></a></li>
            </ul>
          </li>
          <li class="nav-item dropdown"> <a class="nav-link" href="/dev_info.html"><span>Developer Info</span></a>
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="/GetVelma_ForEclipse.html"><span>Clone Github to Local Machine</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/CellSpecificBurnDisturbance_Configuration_Guide.html"><span>Cell Specific Burn Disturbance Config Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/Configuration_Checker_Guide.html"><span>Configuration Checker Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/DefaultSedimentModel_Configuration_Guide.html"><span>Default Sediment Model Config Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/Sediment_Output_Data_Summary.html"><span>Sediment Output Data Summary</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/ForestBurnLsrDisturbanceModel_Overview.html"><span>Forest Burn LSR Disturbance Model</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/JPDEM_ReachMapping_Demonstration.html"><span>JPDEM Reaching Mapping Demo</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/MinMaxAirT_WeatherDrivers.html"><span>Min Max Air Temp Weather Drivers</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/ModifySpatialDataByMap_Guide.html"><span>Modify Spatial Data by Map Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/ObsRunoff_and_NaNs.html"><span>OBS Runnoff and NaNs</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Overview.html"><span>Organic Contaminant Overview</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Remediation_Configuration_Guide.html"><span>Organic Contaminant Redemption Config Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/OrganicContaminant_Tracer_Configuration_Guide.html"><span>Organic Contaminant Tracter Config Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/ReachSpecificObservedRunnoff.html"><span>Reach Specific Observed Runnoff</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/SnowDepth_Initialization_Guide.html"><span>Snow Depth Initialization Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/TopoFiles_Output_Summary.html"><span>Topo Files Output Summary </span></a></li>
              <li class="nav-item"><a class="nav-link" href="/VelmaParallel_Error_Reports.html"><span>Velma Parallel Error Reports</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/VelmaParallel_With_Multiple_Maps.html"><span>Velma Parallel With Multiple Maps </span></a></li>
              <li class="nav-item"><a class="nav-link" href="/WaterDrainDisturbanceModel_Overview.html"><span>Water Drain Disturbance Model</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/VelmaSimulatorCmdLine_Overview.html"><span>Velma Sim Cmd Line Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/VelmaSimulatorAltCmdLine_Overview.html"><span>Velma Sim Alt Cmd Line Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/SurfaceEvaporation_Overview.html"><span>Surface Evaporation Overview</span></a></li>
            </ul>
          </li>
          <li class="nav-item dropdown"> <a class="nav-link" href="/dev_utils.html"><span>Developer Utils</span></a>
            <ul class="nav-dropdown blue-light">
              <li class="nav-item"><a class="nav-link" href="/AscMapOct_Guide.html"><span>Ascii Map Oct Guide </span></a></li>
              <li class="nav-item"><a class="nav-link" href="/AscRangeMask_Guide.html"><span>Ascii Range Mask Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/MoeVelGenerator_Guide.html"><span>MOEA-to-VELMA Configuration Generator</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/NashSutcliffeCalculator_Guide.html"><span>Tool for Computing Nash-Sutcliffe Coefficients</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/NseQuarts_Guide.html"><span>NseQuarts Guide</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/VelmaSimRunner_QuickRef.html"><span>VelmaSimRunner Quick Reference</span></a></li>
              <li class="nav-item"><a class="nav-link" href="/VelmaSimRunner.html"><span>VelmaSimRunner Full Guide</span></a></li>
            </ul>
          </li>
        </ul>
      </nav>
      <div class="search-bar">
        <input id="search" type="search" name="search" placeholder="Search VELMA Docs" autocomplete="off" list="search-suggestions">
      </div>
    </div>
    <div class="modal" id="suggestionModal">
      <div class="modal-content"> <span class="close">&times;</span>
        <h2>Submit a Suggestion </h2>
        <form id="suggestionForm"> 
          <textarea class="suggestion_textbox" id="suggestionText" name="suggestionText" require="True" placeholder="Enter your suggestion here ..."> </textarea>
          <button class="submit_btn" type="submit">Submit</button>
        </form>
      </div>
    </div>
    <div class="main_body container" id="main_body">
      <div class="plus-sign">
        <p>+</p>
      </div>
      <h1>MoeVelGenerator: the MOEA-to-VELMA Configuration Generator</h1>
      <h2>Overview</h2>
      <p>This guide explains what the <code>MoeVelGenerator</code> utility tool is for, and how to use it.</p>
      <h2>Background</h2>
      <p>Running the MOEA Framework for VELMA produces a MOEA outputs .csv file with multiple rows of results, one row per VELMA simulation run. Via the values in its columns, a given row reports the objective scores and VELMA parameters settings (categorized into "variables", "followers", and "exclusives") unique to a particular VELMA run.</p>
      <p>As an example, here is a screen-capture of part of the contents of a MOEA outputs.csv file: <img></p>
      <p>With the contents of the MOEA output .csv file available, the next step in the user's workflow is usually an analysis of which VELMA simulation runs (i.e. rows of MOEA output) are the "best" -- based on the objectives columns scores. For one or more of these best runs, the user typically wishes to re-run VELMA outside of MOEA, to generate full VELMA results and analyze them in detail. But, in order to run VELMA with the same simulation configuration parameters that produced the "best" row of objectives scores the user must recreate the specific .xml configuration file that MOEA ran VELMA with, because MOEA does not report/save that .xml file anywhere.</p>
      <p>The .xml file for a particular row can be created by duplicating the original ("source") VELMA simulation configuration .xml file (specified for use when MOEA ran), and then subsituting each value in the row from a column representing a VELMA parameter inot the duplcate .xml. When this process in completed, the duplicate .xml <em>is</em> the .xml file that MOEA ran to produce the results for the given output row.<br> (Although perhaps not <em>exactly</em> the same: the user will likely set VELMA's <code>suppressAllOutputFiles</code> false instead of true, and change the <code>run_index</code> and .xml file's name to make it and its full results directory easy to identify.)</p>
      <p>Performing the above work manually can be a slow and mistake-prone process, and it is exactly this process that the <code>MoeVelGenerator</code> tool automates: generating a VELMA .xml configuration file from a row of a MOEA outputs .csv file, using a VELMA source .xml as a starting template.</p>
      <h2>Platform Requirements and Runtime Notes</h2>
      <p>Running <code>MoeVelGenerator</code> requires the following:</p>
      <ul>
        <li>Python 3.4 or later</li>
        <li>Windows 10 (although the tool is not Windows-specific, Windows it the only platform it has been tested on).</li>
        <li>Windows Powershell (other shells should work, but PowerShell is the command shell it has been tested on).</li>
      </ul>
      <p>The Step-by-Step Instructions assume a Windows 10 and Powershell environment.</p>
      <h2>Step-by-Step Instructions</h2>
      <p>These instructions start assuming you have already run MOEA for VELMA, and the MOEA configuration and outputs .csv files are available and accessible.</p>
      <h4>1. Determine the VELMA simulation configuration .xml file used as the source for the MOEA output results.</h4>
      <p>The original ("source") VELMA simulation configuration .xml file that MOEA used to build the .xml files for each row of its output results is specified in MOEA's own configuration .csv file. Open that file and find the configuration record (row) containing the keyword "VELMA_SOURCE". The third column in the row should contain the fully-qualified path + name of the VELMA source .xml file. Make a note of this path + file name for use as the <code>velma_xml_source</code> command line argument in Step 3 below.</p>
      <p>You can look for VELMA_SOURCE either by opening the MOEA configuration .csv file in Excel, or by using PowerShell's <code>Select-String</code> cmdlet. Here are examples of each:<br> In Excel:<br> <img> Via <code>Select-String</code>:<br> <img></p>
      <h4>2. Open a PowerShell command window</h4>
      <p><em>(Note: there are many ways of opening PowerShell -- this guide details only one of them.)</em></p>
      <ol>
        <li>Click the Windows Start icon to open the start menu. Note: do not click into the menu, just open it.</li>
        <li>Type "powershell": Windows will replace the start menu with its search results menu.</li>
        <li>Click the "Windows PowerShell" desktop app: it should be the "Best match", at the top of the list of search results.</li>
      </ol>
      <p><img></p>
      <h4>3. Run MoeVelGenerator</h4>
      <p>As mentioned, you must have Python 3 installed and available via the Powershell command window to run <code>MoeVelmGenerator</code>.</p>
      <p>To run MoeVelGenerator, start Python 3 and pass it the fully-qualified location and name of the MoeVelGenerator .py file, followed by command line arguments for MoeVelGenerator.<br> (Typically, Python 3 is started from a PowerShell as <code>py -3</code>, however this may differ on your system; <code>python</code> and <code>python3</code> are other possibilities.)</p>
      <p>But wait -- what <em>are</em> the command line arguments for MoeVelGenerator?<br> You can pass MoeVelGenerator the single argument "-h" or "--help" to ask it list its required and optional arguments.<br> Here is an example, run immediately after starting a Windows Powershell as detailed above in Step 2:</p>
      <p><img></p>
      <p>As the help message indicates, there are 3 required and 1 optional command line arguments that must must appear in the order shown by the message. (The help message refers to these 4 arguments as <em>positional</em> because they must appear on the command line in the order specified)</p>
      <ol>
        <li><code>moea_csv_filename</code><br> (required) the path and filename of the MOEA outputs .csv file to extract parameterization data from.</li>
        <li><code>moea_csv_row_index</code><br> (required) the (integer) row number of the data row to extract parameter values from. As the message indicates, the index number is 1-based, and <em>includes</em> the header row -- so, the index of the first row of the file that contains parameters is "2".<br> (Backstory note: the index numbering scheme was chosen to correspond to the row numbers of the .csv file when viewed in Excel.)</li>
        <li><code>velma_xml_source</code><br> (required) the path and filename of the VELMA simulation configuration .xml file used as the source for the MOEA/VELMA run that generated the MOEA outputs .csv file specified as argument #1 (and that you determined and noted in Step 1 of this guide).</li>
        <li><code>velma_xml_target</code><br> (optional -- but <em>highly</em> recommended) the name of the VELMA simulation configuration file that <code>MoeVelGenerator</code> will create.</li>
      </ol>
      <h4>What about when the VELMA target .xml file already exists?</h4>
      <p><code>MoeVelGenerator</code> won't automatically overwrite a pre-existing file specified by <code>velma_xml_target</code>, however, you can force it to do so by adding the optional <code>--overwrite</code> argument to the end of the command line.<br> The following example illustrates how this works, by first generating a new .xml file, then attempting (and not) overwriting it, then successfully overwriting it by including the prescribed argument:<br> <img></p>
      <h4>What happens when the VELMA target .xml file is <em>not</em> specified?</h4>
      <p>As noted, the <code>velma_xml_target</code> argument is not required, but it is highly recommended.<br> When it is left off the command line, <code>MoeVelGenerator</code> echoes the .xml file that it would have written to stdout (i.e. the PowerShell command window itself) instead. It is possible to still capture the xml by redirecting stdout to a file, but we recommend against this. For one thing, there is no check for whether the file you redirect stdout to exists or not, so capturing the output in this way circumvents the "file already exists?" check that <code>MoeVelGenerator</code> would have performed for you. For another, the automatic equating of the VELMA <code>run_index</code> parameter and the <code>velma_xml_target</code> file name doesn't happen.</p>
      <h4>What about the <code>run_index</code> and <code>suppressAllOutputFiles</code> parameters?</h4>
      <p><code>MoeVelGenerator</code> sets the value of the VELMA <code>run_index</code> parameter to the file name specified by the <code>velma_xml_target</code> argument's values. Only the file name portion is used; the path and dot-extension portions are ignored. As noted above, if no value is specified for <code>velma_xml_target</code>, the value of <code>run_index</code> is left untouched.</p>
      <p><code>MoeVelGenerator</code> does <em>not</em> set suppressAllOutputFiles to <code>true</code>, even if (as is usually the case) it is a parameter in the specified MOEA outputs data row. This is because <code>MoeVelGenerator</code> is usually used to create a simuator configuration for a full-results run.</p>
    </div>
  </body>
  <footer id="footer">
    <p>VELMA 2.2 DOCUMENTATION</p>
  </footer>
</html>